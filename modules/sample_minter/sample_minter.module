<?php

/**
 * @file
 * Contains the sample_minter.module.
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_form_alter().
 *
 * This example adds a field to the form at
 * /admin/config/persistent_identifiers/settings that is specific to the
 * minter provided by this module. The value of the field is saved in the
 * submit callback below.
 *
 * Also, note that the list of minters at /admin/config/persistent_identifiers/settings
 * is derived from minters defined in minter modules' .services.yml files, not by
 * code in hook_form_alter().
 */
function sample_minter_form_alter(&$form, FormStateInterface &$form_state, $form_id) {
  if ($form_id == 'persistent_identifiers_admin_settings') {
    $form['sample_begin_label'] = array(
      '#type' => 'markup',
      '#markup' => '<label><b>Sample</b></label><hr>',
    );

    $config = \Drupal::config('sample_minter.settings');
    $form['sample_minter_namespace'] = [
      '#type' => 'textfield',
      '#access' => TRUE,
      '#title' => 'Sample identifier namespace',
      '#default_value' => $config->get('sample_minter_namespace'),
      '#description' => t("This string will be prepended to the random number generated by this minter."),
      '#states' => [
        'visible' => [
          ':input[id="persistent_identifiers_minter"]' => ['value' => 'sample_minter.minter.sample'],
        ],
      ],
    ];
    $form['sample_end_label'] = array(
      '#type' => 'markup',
      '#markup' => '<br><br>',
    );
    $form['#submit'][] = 'sample_minter_submit';
  }
}

/**
 * Submit callback.
 *
 * Saves the value of the minter-specific field defined in the implementation
 * of hook_form_alter() above.
 *
 * @param array $form
 *   The form.
 * @param \Drupal\Core\Form\FormStateInterface $form_state
 *   The form state.
 */
function sample_minter_submit(array &$form, FormStateInterface $form_state) {
  $namespace = $form_state->getValue('sample_minter_namespace', 'sample:');
  $config_factory = \Drupal::configFactory();
  $config_factory->getEditable('sample_minter.settings')
    ->set('sample_minter_namespace', trim($namespace))
    ->save();
}
